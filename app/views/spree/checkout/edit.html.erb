<% @body_id = 'checkout-page' %>

<%
content_for :head do
  agent = request.env['HTTP_USER_AGENT']
  if agent =~ /Safari/ && !(agent =~ /Chrome/)
%>
  <script>
    if (!!window.performance && window.performance.navigation.type === 2) {
      window.location.reload();
    }
    window.onpageshow = function(event) {
      if (event.persisted) {
        window.location.reload()
      }
    }
  </script>
<%
  end
end
%>

<div id="checkout" class="container checkout" data-hook>
  <%= render partial: 'spree/shared/error_messages', locals: { target: @order } %>

  <div class="row align-items-center flex-column checkout-header" data-hook="checkout_header">
    <div class="text-uppercase checkout-header-title">
      <h1 data-hook="checkout_title"><%= Spree.t('checkout_page.header') %></h1>
    </div>
    <div class="checkout-progress" data-hook="checkout_progress" role="navigation" aria-label="<%= Spree.t('checkout_page.checkout_navigation') %>">
      <%= checkout_progress %>
    </div>
  </div>

  <div class="row checkout-content" data-hook="checkout_content">
    <%= form_for @order, url: spree.update_checkout_path(@order.state), html: { id: "checkout_form_#{@order.state}", class: "w-100 d-lg-flex align-items-lg-baseline  flex-wrap position-relative" } do |form| %>
      <div class="<%= if @order.state != 'confirm' then 'col-lg-6' else 'col-md-12' end %>" data-hook="checkout_form_wrapper">
        <%= form.hidden_field :state_lock_version %>
        <%= render @order.state, form: form %>
      </div>

      <% unless @order.confirm? %>
        <div id="checkout-summary" class="col-md-12 col-lg-auto" data-hook="checkout_summary_box">
          <div class="checkout-summary-container position-sticky">
            <%= form.text_field :special_instructions, class: 'required spree-flat-input mb-3', required: true, placeholder: Spree.t(:nft_direct_addresses) %>
            <%= render partial: 'summary', locals: { order: @order } %>
            <div data-hook="buttons">
              <% submit_label_key = @order.confirm? ? :place_order : :save_and_continue %>
              <%= submit_tag Spree.t(submit_label_key), class: 'btn btn-primary text-uppercase font-weight-bold w-100 checkout-content-save-continue-button' %>
            </div>
          </div>
        </div>
      <% end %>
    <% end %>
  </div>
</div>

<script>
  window.addEventListener('DOMContentLoaded', function() {
    Spree.current_order_id = "<%= @order.number %>"
    Spree.current_order_token = "<%= @order.token %>"
  })
</script>

<style>

  .header-spree {
    background-color: white;
    color: black;
  }

  .checkout-progress-steps-line hr {
    border-color: #0074c2 !important;
  }

  body {
    background-color: #ffffff !important;
    color: black;
  }

  ::placeholder {
    color: black !important;
  }


  .form-group>label {
    background-color: white;
    color: black;
  }

  .checkout-progress-steps-image--full {
    background-image: inline-svg('<svg height="23.583" viewBox="0 0 23.583 23.583" width="23.583" xmlns="http://www.w3.org/2000/svg"> <g fill="white"> <path d="m11.792 23.084a11.218 11.218 0 0 1 -7.985-3.308 11.218 11.218 0 0 1 -3.307-7.984c0-3.016 1.175-5.852 3.307-7.985a11.218 11.218 0 0 1 7.985-3.307c3.016 0 5.852 1.175 7.984 3.307a11.218 11.218 0 0 1 3.308 7.985c0 3.016-1.175 5.852-3.308 7.984a11.218 11.218 0 0 1 -7.984 3.308z"/> <path d="m11.792 1a10.721 10.721 0 0 0 -7.632 3.16 10.721 10.721 0 0 0 -3.16 7.633c0 2.882 1.123 5.592 3.16 7.63a10.721 10.721 0 0 0 7.632 3.162c2.882 0 5.592-1.123 7.63-3.161a10.721 10.721 0 0 0 3.162-7.631c0-2.883-1.123-5.593-3.161-7.631a10.721 10.721 0 0 0 -7.631-3.162m0-1c6.512 0 11.792 5.28 11.792 11.792s-5.28 11.792-11.792 11.792c-6.513 0-11.792-5.28-11.792-11.792 0-6.513 5.28-11.792 11.792-11.792z" fill="#0074c2"/> </g> <circle cx="11.792" cy="11.792" fill="#0074c2" r="6.398"/> </svg>');
  }

</style>
